<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Snap Your Moment!</title>

  <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Schoolbell&display=swap" rel="stylesheet">

 <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Chewy', sans-serif;
      background: url('BG DEMO.png') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #loading {
      font-size: 24px;
      font-weight: bold;
    }

    #loadingScreen {
      background: url('BG_DEMO.png') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(5px);
      font-size: 24px;
      font-weight: bold;
      color: black;
      display: flex;
      flex-direction: column;
    }

    #startButton {
      padding: 10px 30px;
      font-size: 24px;
      border: none;
      border-radius: 10px;
      background-color: #1e88e5;
      color: white;
      cursor: pointer;
    }

    #cameraScreen {
      background: url('BG_DEMO.png') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(5px);
      flex-direction: column;
      justify-content: flex-start;
    }

    video, canvas {
      width: 360px;
      height: 640px;
      object-fit: cover;
      transform: scaleX(-1);
      border-radius: 16px;
      margin-top: 20px;
    }

    #controls {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .slider {
      display: flex;
      overflow-x: auto;
      width: 80%;
      margin: 10px auto;
    }

    .slider button {
      min-width: 80px;
      height: 80px;
      margin: 0 5px;
      border: none;
      border-radius: 50%;
      background-color: white;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .slider button.selected {
      transform: scale(1.3);
    }

    #filterSelect, #modeSelect {
      margin: 10px;
      font-size: 16px;
    }

    #retake, #download, #back {
      margin: 10px;
      padding: 8px 16px;
      font-size: 16px;
      background-color: #1e88e5;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #backButton {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }

    #inputName {
      margin: 10px auto;
      padding: 5px;
      width: 80%;
    }
  </style>
</head>

<body>

  <div id="startScreen" style="display:flex; justify-content:center; align-items:center; height:100vh;">
    <img src="BG_DEMO.png" style="position:absolute; width:100%; height:100%; object-fit:cover;">
    <button id="startButton">START</button>
  </div>

  <div id="loadingScreen">
    Loading...
  </div>

  <div id="cameraScreen">
    <button id="backButton">‚ùå</button>
    <video id="video" autoplay playsinline></video>

    <div id="controls">
      <button id="capture">Quiksnap</button>
      <button id="retake" style="display:none;">Retake</button>
      <a id="download" style="display:none;">Download</a>
    </div>

    <input type="text" id="inputName" placeholder="Enter your message" style="display:none;">

    <div class="slider" id="slider"></div>

    <select id="modeSelect">
      <option value="photo">Photo</option>
      <option value="video">Video (10s)</option>
    </select>

    <select id="filterSelect">
      <option value="none">No Filter</option>
      <option value="brightness(1.2)">Bright</option>
      <option value="contrast(1.2)">Contrast</option>
      <option value="saturate(1.2)">Vivid</option>
    </select>

    <canvas id="canvas" style="display:none;"></canvas>
  </div>

  <script>
    const startScreen = document.getElementById('startScreen');
    const loadingScreen = document.getElementById('loadingScreen');
    const cameraScreen = document.getElementById('cameraScreen');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const capture = document.getElementById('capture');
    const retake = document.getElementById('retake');
    const download = document.getElementById('download');
    const backButton = document.getElementById('backButton');
    const slider = document.getElementById('slider');
    const modeSelect = document.getElementById('modeSelect');
    const filterSelect = document.getElementById('filterSelect');
    const inputName = document.getElementById('inputName');

    let stream;
    let mediaRecorder;
    let recordedChunks = [];
    let currentIndex = 0;
    const backgrounds = ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png'];
    const frames = ['frame1.png', 'frame2.png', 'frame3.png', 'frame4.png', 'frame5.png', 'frame6.png'];

    document.getElementById('startButton').onclick = () => {
      startScreen.style.display = 'none';
      loadingScreen.style.display = 'flex';
      startCamera();
    };

    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        video.srcObject = stream;
        video.play();

        setTimeout(() => {
          loadingScreen.style.display = 'none';
          cameraScreen.style.display = 'flex';
        }, 500);
      } catch (error) {
        loadingScreen.innerHTML = 'Camera not accessible. Please check permissions.';
      }
    }

    function updateBackground(index) {
      document.body.style.background = `url(${backgrounds[index]}) no-repeat center center fixed`;
      document.body.style.backgroundSize = 'cover';
      slider.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
      slider.querySelectorAll('button')[index].classList.add('selected');
    }

    backgrounds.forEach((bg, index) => {
      const btn = document.createElement('button');
      btn.style.backgroundImage = `url(${bg})`;
      btn.style.backgroundSize = 'cover';
      btn.onclick = () => {
        currentIndex = index;
        updateBackground(index);
      };
      slider.appendChild(btn);
    });

    updateBackground(0);

    capture.onclick = () => {
      const ctx = canvas.getContext('2d');
      canvas.width = 1080;
      canvas.height = 1920;

      ctx.save();
      ctx.scale(-1, 1);
      ctx.translate(-canvas.width, 0);
      ctx.filter = filterSelect.value;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      ctx.restore();

      const frame = new Image();
      frame.src = frames[currentIndex];
      frame.onload = () => {
        ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
        ctx.font = '48px "Schoolbell", cursive';
        ctx.fillStyle = 'white';
        ctx.fillText(inputName.value, 50, 1800);

        canvas.style.display = 'block';
        inputName.style.display = 'block';
        download.href = canvas.toDataURL('image/png');
        download.download = `photo_${Date.now()}.png`;
        download.style.display = 'inline-block';
        retake.style.display = 'inline-block';
      };
    };

    retake.onclick = () => location.reload();
    backButton.onclick = () => location.reload();

    filterSelect.onchange = () => video.style.filter = filterSelect.value;
  </script>

</body>

</html>
